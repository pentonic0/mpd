<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StreamFlow Player</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
  
  <!-- Tailwind CSS for modern styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts for a clean look -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- Font Awesome for modern icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  
  <style>
    :root {
      --player-theme: #6d28d9; /* Deep Violet */
      --player-theme-hover: #5b21b6;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background-color: #0f172a; /* Slate 900 */
    }
    
    /* Custom styles for range inputs (volume/progress) */
    .slider-track {
      -webkit-appearance: none;
      appearance: none;
      background: transparent;
      cursor: pointer;
      width: 100%;
    }
    
    .slider-track:focus {
      outline: none;
    }

    /* Track */
    .slider-track::-webkit-slider-runnable-track {
      width: 100%;
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      transition: height 0.2s ease;
    }
    
    .slider-track::-moz-range-track {
      width: 100%;
      height: 5px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 5px;
      transition: height 0.2s ease;
    }
    
    .video-container:hover .slider-track::-webkit-slider-runnable-track,
    .progress-bar-container:hover .slider-track::-webkit-slider-runnable-track {
      height: 8px;
    }

    /* Thumb */
    .slider-track::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      margin-top: -6px; /* Adjust to center */
      background-color: var(--player-theme);
      height: 16px;
      width: 16px;
      border-radius: 50%;
      border: 2px solid #fff;
      transform: scale(0);
      transition: transform 0.2s ease-in-out;
    }
    
    .slider-track::-moz-range-thumb {
      background-color: var(--player-theme);
      height: 16px;
      width: 16px;
      border-radius: 50%;
      border: 2px solid #fff;
      transform: scale(0);
      transition: transform 0.2s ease-in-out;
    }

    .video-container:hover .slider-track::-webkit-slider-thumb,
    .progress-bar-container:hover .slider-track::-webkit-slider-thumb,
    .slider-track:focus::-webkit-slider-thumb {
      transform: scale(1);
    }

    /* Loading Spinner */
    .loader {
      border: 4px solid rgba(255, 255, 255, 0.2);
      border-left-color: var(--player-theme);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .control-btn {
      color: white;
      transition: color 0.2s ease, transform 0.2s ease;
    }
    
    .control-btn:hover {
      color: var(--player-theme);
      transform: scale(1.1);
    }
    
    /* Server list styles */
    .server-btn {
      background-color: #1e293b;
      border: 1px solid #334155;
      transition: all 0.2s ease;
    }
    
    .server-btn:hover {
      background-color: #334155;
      border-color: var(--player-theme);
    }
    
    .server-btn.active {
      background-color: var(--player-theme);
      border-color: var(--player-theme);
    }
    
    /* New server card styles */
    .server-card {
      background: linear-gradient(145deg, #1e293b, #0f172a);
      border: 1px solid #334155;
      transition: all 0.3s ease;
      overflow: hidden;
    }
    
    .server-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(109, 40, 217, 0.2);
      border-color: var(--player-theme);
    }
    
    .server-card.active {
      border-color: var(--player-theme);
      box-shadow: 0 0 0 2px var(--player-theme), 0 10px 25px rgba(109, 40, 217, 0.3);
    }
    
    .server-card-header {
      background: rgba(109, 40, 217, 0.1);
      border-bottom: 1px solid #334155;
    }
    
    .quality-badge {
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 4px;
      background: var(--player-theme);
    }
    
    .server-status {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #10b981;
    }
    
    .server-status.offline {
      background: #ef4444;
    }
    
    /* Delete button styles - always visible */
    .delete-server-btn {
      opacity: 1;
      transition: all 0.3s ease;
    }
    
    .delete-server-btn:hover {
      color: #ef4444 !important;
      transform: scale(1.1);
    }
    
    /* Play button for predefined servers */
    .play-indicator {
      color: #6d28d9;
    }
    
    /* Improved Volume Slider Styles */
    .volume-container {
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .volume-slider-container {
      position: relative;
      width: 0;
      overflow: hidden;
      transition: width 0.3s ease;
      margin-left: 8px;
    }
    
    .volume-container:hover .volume-slider-container {
      width: 100px;
    }
    
    .volume-slider {
      -webkit-appearance: none;
      width: 100%;
      height: 5px;
      border-radius: 5px;
      background: rgba(255, 255, 255, 0.2);
      outline: none;
      transition: all 0.2s ease;
    }
    
    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--player-theme);
      cursor: pointer;
      border: 2px solid white;
      transition: all 0.2s ease;
    }
    
    .volume-slider::-moz-range-thumb {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--player-theme);
      cursor: pointer;
      border: 2px solid white;
      transition: all 0.2s ease;
    }
    
    .volume-slider:hover {
      height: 8px;
    }
    
    .volume-slider:hover::-webkit-slider-thumb {
      transform: scale(1.2);
    }
    
    .volume-slider:hover::-moz-range-thumb {
      transform: scale(1.2);
    }
    
    .volume-level-indicator {
      position: absolute;
      height: 5px;
      background: var(--player-theme);
      border-radius: 5px;
      pointer-events: none;
      transition: height 0.2s ease;
    }
    
    .volume-container:hover .volume-level-indicator {
      height: 8px;
    }
    
    /* JW Player container styling */
    #player-container {
      width: 100%;
      height: 0;
      padding-bottom: 56.25%; /* 16:9 aspect ratio */
      position: relative;
      background-color: #000;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    #player-container .jwplayer {
      position: absolute !important;
      width: 100% !important;
      height: 100% !important;
      top: 0;
      left: 0;
    }
  </style>
</head>

<body class="bg-slate-900 text-white flex flex-col items-center justify-center min-h-screen p-4 md:p-6">
  <div class="w-full max-w-6xl mx-auto">
    <div class="text-center mb-6">
      <h1 class="text-3xl md:text-5xl font-bold tracking-tight">StreamFlow Player</h1>
      <p class="text-slate-400 mt-2 text-sm md:text-base">Select a server to begin streaming.</p>
    </div>
    
    <!-- Video Player Container -->
    <div id="video-container" class="video-container w-full bg-black rounded-xl shadow-2xl shadow-slate-900/50 overflow-hidden relative group aspect-video">
      <div id="player-container"></div>

      <!-- Loading Indicator -->
      <div id="loading-spinner" class="absolute inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center hidden z-30">
        <div class="loader"></div>
      </div>
    </div>
    
    <!-- Server Selection Section -->
    <div class="mt-8">
      <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold">Available Servers</h2>
          <p class="text-slate-400 mt-1 text-sm">Select a server to start streaming instantly</p>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 w-full sm:w-auto mt-4 sm:mt-0">
          <div class="relative flex-grow">
            <input id="new-server-input" type="text" placeholder="Enter M3U8/MPD URL to add server" class="w-full bg-slate-800 border border-slate-700 text-white rounded-lg px-4 py-3 pl-10 focus:outline-none focus:ring-2 focus:ring-violet-500 transition shadow-sm placeholder-slate-500">
            <i class="fa-solid fa-link absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-500"></i>
          </div>
          <button id="add-server-btn" class="bg-violet-700 hover:bg-violet-600 text-white font-medium py-3 px-6 rounded-lg transition-all flex items-center justify-center gap-2 shadow-lg hover:shadow-violet-500/30">
            <i class="fa-solid fa-plus"></i>
            <span>Add Server</span>
          </button>
        </div>
      </div>
      
      <div id="server-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- Server cards will be dynamically added here -->
      </div>
      
      <!-- Empty state when no servers available -->
      <div id="empty-state" class="text-center py-12 hidden">
        <div class="bg-slate-800/50 rounded-2xl p-8 max-w-md mx-auto">
          <i class="fa-solid fa-satellite-dish text-5xl text-slate-600 mb-4"></i>
          <h3 class="text-xl font-semibold mb-2">No servers available</h3>
          <p class="text-slate-400 mb-6">Add a server using the form above to get started.</p>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
      // Predefined servers with URLs and optional DRM keys
      const predefinedServers = [
        {
          name: "Main Server",
          url: "https://cdn.jwplayer.com/manifests/pZxWPRg4.m3u8",
          keyId: "",
          key: "",
          quality: "HD",
          status: "online",
          icon: "ðŸ“º"
        },
        {
          name: "Backup Server",
          url: "https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8",
          keyId: "",
          key: "",
          quality: "HD",
          status: "online",
          icon: "ðŸ”„"
        },
        {
          name: "Sports Stream",
          url: "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8",
          keyId: "",
          key: "",
          quality: "SD",
          status: "online",
          icon: "âš½"
        },
        {
          name: "Movie Server",
          url: "https://multiplatform-f.akamaihd.net/i/multi/will/bunny/big_buck_bunny_,640x360_400,640x360_700,640x360_1000,950x540_1500,.f4v.csmil/master.m3u8",
          keyId: "",
          key: "",
          quality: "HD",
          status: "online",
          icon: "ðŸŽ¬"
        },
        {
          name: "Documentary Server",
          url: "https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8",
          keyId: "",
          key: "",
          quality: "SD",
          status: "online",
          icon: "ðŸŒ"
        },
        {
          name: "Music Stream",
          url: "https://content.jwplayer.com/manifests/vM7nH0Kl.m3u8",
          keyId: "",
          key: "",
          quality: "HD",
          status: "online",
          icon: "ðŸŽµ"
        },
        {
          name: "Sports",
          url: "https://live.shoq.com.pk/live/eds/ICC_Women_World_Cup_2025/DASH/ICC_Women_World_Cup_2025.mpd",
          keyId: "a6dfc4f17d70d8d07639659193f03b25",
          key: "893eacfabe386144b81733d622a7ad17",
          quality: "HD",
          status: "online",
          icon: "âš½"
        }
      ];

      let currentPlayer = null;
      let currentServerIndex = -1;
      let customServers = [];

      // DOM Elements
      const loadingSpinner = document.getElementById('loading-spinner');
      const serverList = document.getElementById('server-list');
      const newServerInput = document.getElementById('new-server-input');
      const addServerBtn = document.getElementById('add-server-btn');
      const emptyState = document.getElementById('empty-state');

      /**
       * Waits for the JWPlayer library to be loaded before executing a callback.
       */
      function waitForJWPlayer(callback) {
        if (typeof jwplayer === 'function') {
          callback();
        } else {
          setTimeout(() => waitForJWPlayer(callback), 100);
        }
      }

      /**
       * Initialize the server list
       */
      function initializeServerList() {
        serverList.innerHTML = '';
        
        const allServers = [...predefinedServers, ...customServers];
        
        if (allServers.length === 0) {
          emptyState.classList.remove('hidden');
          serverList.classList.add('hidden');
        } else {
          emptyState.classList.add('hidden');
          serverList.classList.remove('hidden');
          
          // Add predefined servers
          predefinedServers.forEach((server, index) => {
            addServerCard(server.name, server.url, server.quality, server.status, server.icon, index);
          });
          
          // Add custom servers
          customServers.forEach((server, index) => {
            addServerCard(server.name, server.url, server.quality || "Custom", server.status || "online", "ðŸ”—", predefinedServers.length + index, true);
          });
        }
      }
      
      /**
       * Add a server card to the list
       */
      function addServerCard(name, url, quality, status, icon, index, isCustom = false) {
        const card = document.createElement('div');
        card.className = 'server-card rounded-xl p-4 cursor-pointer';
        card.innerHTML = `
          <div class="server-card-header p-3 -mx-4 -mt-4 mb-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
              <div class="server-status ${status === 'online' ? '' : 'offline'}"></div>
              <span class="text-sm font-medium text-slate-300">${status === 'online' ? 'Online' : 'Offline'}</span>
            </div>
            <span class="quality-badge text-white text-xs font-semibold">${quality}</span>
          </div>
          <div class="flex justify-between items-center">
            <div class="flex items-center gap-3 flex-1 min-w-0">
              <div class="text-xl">${icon}</div>
              <div class="flex-1 min-w-0">
                <h3 class="font-semibold text-white truncate">${name}</h3>
              </div>
            </div>
            <div class="flex items-center ml-2">
              ${isCustom ? 
                '<button class="delete-server-btn text-slate-400 hover:text-red-500 p-2 rounded-full transition-colors" title="Delete server">' +
                  '<i class="fa-solid fa-trash"></i>' +
                '</button>' : 
                '<i class="fa-solid fa-play play-indicator ml-2"></i>'
              }
            </div>
          </div>
        `;
        
        card.addEventListener('click', (e) => {
          if (!e.target.closest('.delete-server-btn')) {
            // Play this server
            switchToServer(index);
            
            // Update active state
            document.querySelectorAll('.server-card').forEach(card => {
              card.classList.remove('active');
            });
            card.classList.add('active');
          }
        });
        
        // Add delete functionality for custom servers
        if (isCustom) {
          const deleteBtn = card.querySelector('.delete-server-btn');
          deleteBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            // Remove custom server
            customServers = customServers.filter(s => s.url !== url);
            saveCustomServers();
            initializeServerList();
          });
        }
        
        serverList.appendChild(card);
      }
      
      /**
       * Save custom servers to localStorage
       */
      function saveCustomServers() {
        localStorage.setItem('customServers', JSON.stringify(customServers));
      }
      
      /**
       * Load custom servers from localStorage
       */
      function loadCustomServers() {
        const saved = localStorage.getItem('customServers');
        if (saved) {
          customServers = JSON.parse(saved);
        }
      }
      
      /**
       * Add a new custom server
       */
      function addCustomServer() {
        const url = newServerInput.value.trim();
        if (url && (url.includes('.m3u8') || url.includes('.mpd'))) {
          const name = `Custom Server ${customServers.length + 1}`;
          customServers.push({ 
            name, 
            url, 
            quality: "Custom",
            status: "online"
          });
          saveCustomServers();
          initializeServerList();
          newServerInput.value = '';
          
          // Auto-play the newly added server
          const newIndex = predefinedServers.length + customServers.length - 1;
          switchToServer(newIndex);
          
          // Update active state
          setTimeout(() => {
            const cards = document.querySelectorAll('.server-card');
            if (cards.length > 0) {
              cards.forEach(card => card.classList.remove('active'));
              cards[cards.length - 1].classList.add('active');
            }
          }, 100);
        } else {
          alert('Please enter a valid M3U8 or MPD URL');
        }
      }

      /**
       * Switches to a predefined server
       * @param {number} index - Index of the server in predefinedServers array
       */
      function switchToServer(index) {
        const allServers = [...predefinedServers, ...customServers];
        const server = allServers[index];
        
        if (!server) return;
        
        loadingSpinner.classList.remove('hidden');
        
        // Setup player with new server
        waitForJWPlayer(() => {
          let streamType = '';
          if (server.url.includes('.mpd')) {
            streamType = 'dash';
          } else if (server.url.includes('.m3u8')) {
            streamType = 'hls';
          }

          const playerConfig = {
            file: server.url,
            autostart: true,
            width: "100%",
            height: "100%",
            stretching: "uniform",
          };
          
          if (streamType) {
              playerConfig.type = streamType;
          }

          // Add DRM settings only if both keyId and key are provided
          if (server.keyId && server.key) {
            playerConfig.drm = {
              clearkey: {
                keyId: server.keyId,
                key: server.key,
              },
            };
          }

          // Remove existing player if it exists
          if (currentPlayer) {
            currentPlayer.remove();
          }
          
          currentPlayer = jwplayer("player-container").setup(playerConfig);
          currentServerIndex = index;
          
          // Hide loading spinner when player is ready
          currentPlayer.on('ready', () => {
            loadingSpinner.classList.add('hidden');
          });
          
          currentPlayer.on('error', () => {
            loadingSpinner.classList.add('hidden');
          });
        });
      }

      /**
       * Initialize the page - set up the server panel and auto-play the first server
       */
      function initializePage() {
        loadCustomServers();
        initializeServerList();
        
        // Auto-play the first server
        if (predefinedServers.length > 0) {
          setTimeout(() => {
            switchToServer(0);
            const firstCard = document.querySelector('.server-card');
            if (firstCard) firstCard.classList.add('active');
          }, 500);
        }
      }

      // Event listeners
      addServerBtn.addEventListener('click', addCustomServer);
      newServerInput.addEventListener('keypress', (e) => e.key === 'Enter' && addCustomServer());

      // Initialize the page when DOM is loaded
      initializePage();
    });
  </script>
</body>
</html>
